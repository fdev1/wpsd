DESTDIR=
INSTALL=@INSTALL@
prefix=@prefix@
ICONS_DIR=@datarootdir@/icons
SYSCONFDIR=@sysconfdir@

CC=@CC@
CFLAGS += -Wall -DSYSCONFDIR=\"@sysconfdir@\"
EXECUTABLE = wps
DAEMON = wpsd
SOURCES = wpsd.c wps.c utils.c logger.c
OBJECTS = $(SOURCES:.c=.o)

all: $(SOURCES) $(EXECUTABLE) $(DAEMON)

$(EXECUTABLE): $(OBJECTS)
	$(CC) -o $@ wps.o

$(DAEMON): $(OBJECTS)
	$(CC) -ldl -o $@ wpsd.o utils.o logger.o
	sed -e "s|@PREFIX@|$(prefix)|g" wpsd.service.in > wpsd.service

.c.o:
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -f $(OBJECTS) $(EXECUTABLE) $(DAEMON)
	rm -f wpsd.service

mrproper: clean
	rm -f configure
	rm -fr autom4te.cache
	rm -f config.log
	rm -f config.status

install:
	$(INSTALL) -d $(DESTDIR)/$(prefix)/bin
	$(INSTALL) -d $(DESTDIR)/usr/lib/systemd/system
	$(INSTALL) -d $(DESTDIR)/$(SYSCONFDIR)
	$(INSTALL) $(EXECUTABLE) $(DESTDIR)/$(prefix)/bin
	$(INSTALL) $(DAEMON) $(DESTDIR)/$(prefix)/bin
	$(INSTALL) wpsd.service $(DESTDIR)/usr/lib/systemd/system
	$(INSTALL) wpsd.conf $(DESTDIR)/$(SYSCONFDIR)

uninstall:
	$(RM) $(DESTDIR)/$(prefix)/bin/$(EXECUTABLE)
	$(RM) $(DESTDIR)/$(prefix)/bin/$(DAEMON)
