
# set this to 1 to enable an autostart option
# on the settings dialog
ENABLE_AUTOSTART=@autostart@

DESTDIR=
INSTALL=@INSTALL@
prefix=@prefix@
ICONS_DIR=@datarootdir@/icons

CC=@CC@
CFLAGS=-O2 -Wall
LDFLAGS=-ldl
EXECUTABLE=wps
DAEMON=wpsd
SOURCES=wpsd.c wps.c
OBJECTS=$(SOURCES:.c=.o)

all: $(SOURCES) $(EXECUTABLE) $(DAEMON)

$(EXECUTABLE): $(OBJECTS)
	$(CC) -o $@ wps.o

$(DAEMON): $(OBJECTS)
	$(CC) $(LDFLAGS) -o $@ wpsd.o
	sed -e "s|@PREFIX@|$(prefix)|g" wpsd.service.in > wpsd.service

.c.o:
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -f $(OBJECTS) $(EXECUTABLE) $(DAEMON)
	rm -f wpsd.service

install:
	$(INSTALL) -d $(DESTDIR)/$(prefix)/bin
	$(INSTALL) -d /usr/lib/systemd/system
	$(INSTALL) $(EXECUTABLE) $(DESTDIR)/$(prefix)/bin
	$(INSTALL) $(DAEMON) $(DESTDIR)/$(prefix)/bin
	$(INSTALL) wpsd.service /usr/lib/systemd/system

uninstall:
	$(RM) $(DESTDIR)/$(prefix)/bin/$(EXECUTABLE)
	$(RM) $(DESTDIR)/$(prefix)/bin/$(DAEMON)
